{% extends 'newshub/framework/base.html' %}
{% load staticfiles widget_tweaks%}
{% block content %}

<div class="row article-forms fill-height">
	<div class="col-sm-2 affixed-sidebar left-sidebar">
		<ul class="nav nav-pills nav-stacked">
			<li class="header first-header"><p>Saved Articles<p></li>
			{% for article in request.user.author.article_set.all %}
			{% if not article.published %}
			<li class="saved-article"><a href="{% url 'newshub:edit_article' pk=article.pk %}">{{article.title}}</a></li>
			{% endif %}
			{% endfor %}
			<li class="header"><p>Published Articles<p></li>
			{% for article in request.user.author.article_set.all %}
			{% if article.published %}
			<li class="saved-article"><a href="{% url 'newshub:edit_article' pk=article.pk %}">{{article.title}}</a></li>
			{% endif %}
			{% endfor %}
		</ul>
    </div><!-- previous-articles-sidebar -->
	<div id="article-forms-col" class="col-md-8">
		<form id="article-post-form" method="post" action="" enctype="multipart/form-data" >
			{% csrf_token %}
			{% for field in form%}
			<div class="form-group {%if field.errors %}has-feedback has-error{%endif%}">
				{% if field.html_name == 'published' %}
				<label for="{{field.id_for_label}}">{{field.label}}</label>
					{{field}}
				{% elif field.html_name == 'poll' and not add%}
			
				{% else%}
					<label for="{{field.id_for_label}}">{{field.label}}</label>
					{% render_field field placeholder=field.label class='form-control' autocomplete='off'%}

	               <span class="help-block">
						<p>{{field.help_text}}</p>
	                {% for error in field.errors %}
	                        {{error}}
	                {% endfor %}
	               	</span>
	            {%endif%}
			</div>
			{% endfor %}

		</form>
	</div>
	<div class="col-md-2 affixed-sidebar right-sidebar">
		<ul class="nav nav-pills nav-stacked">
			{% if form.instance.published %} <!-- Can't figure out how to make it published -->
			<li><input class="red" type="submit" name="action" value="&#10003; Published" form="article-post-form"/></li> <!-- THIS CURRENTLY DOES NOTHING -->
			{% else %}
			<li><input type="submit" name="action" value="Publish" form="article-post-form"/></li>
			{% endif %}
			{% if not add %}
			<li><a href="{% url 'newshub:view_article' action_type='home' pk=form.instance.pk %}" class="btn btn-default">View</a></li>
			{% endif %}
			<li><input type="submit" name="action" value="Save" form="article-post-form"/></li>
		</ul>
		<div class="article-poll-form">
			{% if not add %}
			<div class="article-poll-add-title">
				Add a poll for the article
			</div>
				{% if form.instance.poll %}
					<p>Poll exists: <b>{{form.instance.poll}}</b></p>
					<ul class="nav nav-pills nav-stacked">
						<li><a class="btn btn-default" href="{% url 'newshub:article_edit_poll' pk=form.instance.poll.pk %}">Edit poll</a></li>
						<li><a class="btn btn-default" href="{% url 'newshub:article_delete_poll' pk=form.instance.poll.pk %}">Delete the poll</a></li>
					</ul>
				{%else%}
				<form action="{% url 'newshub:article_add_poll' %}" method="post">
					{% csrf_token %}
					{% for hidden in poll_form.hidden_fields %}
	                        {{ hidden }}
	                    {% endfor %}
					{% for field in poll_form.visible_fields %}
					<div class="form-group {%if field.errors %}has-feedback has-error{%endif%}">
						<label for="{{field.id_for_label}}">{{field.label}}</label>
						{% if field.html_name == 'published' %}
							{{field}}
						{% else%}
							{% render_field field placeholder=field.label class='form-control' autocomplete='off'%}
							<span class="help-block">
								<p>{{field.help_text}}</p>
			                {% for error in field.errors %}
			                        {{error}}
			                {% endfor %}
			               	</span>
			            {%endif%}
					</div>
					{% endfor %}
					<ul class="nav nav-pills nav-stacked">
						<li><input type="submit" value="Add poll" class="btn btn-default" /></li>
					</ul>
				</form>
				{% endif %}
			{% endif %}
		</div>
	</div>
</div>
<script>
$(function() {
    $('form').areYouSure( {'message':'Your article is not finished yet.'} );
});
</script>
{% endblock %}