{% extends 'newshub/framework/base.html' %}
{% load widget_tweaks %}
{% comment %}
	Profile page of the User/Author. 

	Data received 
	-----
	user: the user object who's profile we are viewing
		- first_name
		- last_name
		- email
		- profile: the profile object. Each user has a profile object associated with them.
			- picture: a Django ImageField object, containing the profile picture from facebook
			- about: a short description, which is optional to provide after signing up.
			- crsid: cambridge universities id. only needed if a user wants to become an author.
		- article_set.all: the list of users article objects
			- article: a single article 
				- author: the user object of the article, ie. who created it
				- title
				- headline
				- content
				- tags: a list of tags
					-tag
						- name: the name of the tag such as 'football'
						- category: the category object. Each tag has one category, but a signle category can have many tags. Example would be 'Sport'
							- name: the name of the category
				- time_uploaded: a datetime object of when was the article first uploaded
				- time_changed: the time of the last save of the article
{% endcomment %}
{% block title %}Profile{% endblock%}
{% block content %}
<div class="row fill-height">
    <div class="col-sm-2 affixed-sidebar left-sidebar">
        <ul class="nav nav-pills nav-stacked">
            <li class="active"><a href="#profile" data-toggle="pill">About Me</a></li>
            <li><a href="#profile-articles" data-toggle="pill">Articles</a></li>
            <!--
            <li><a href="#" data-toggle="pill">Awards</a></li>
            <li><a href="#" data-toggle="pill">C.V.</a></li>
            <li><a href="#" data-toggle="pill">Statistics</a></li>
            -->
            {% if request.user == user %}
            <li><a href="#profile-update" data-toggle="pill">Edit Profile</a></li>
            {% endif %}
        </ul>
    </div><!-- /.article-sidebar -->

    <div class="col-sm-8 main tab-content profile-page">
    	<div id="profile" class="row center-block tab-pane active">
			<div class="row">
				<div class="col-sm-5 profile-picture">
					<img class="img-responsive profile-picture" src="{{user.profile.picture.url}}" /> 
				</div>
				<div class="col-sm-7 profile-description">
					<h2>{{user.profile.display_name}}</h2>
					<p>{% if user.profile.get_year_display %}{{user.profile.get_year_display}}{%endif%} {% if user.profile.subject %}{{user.profile.subject}}{%endif%} Student</p>
					<p>{% if user.profile.college %}at {{user.profile.college}}{% else %}Not specified{%endif%} College</p>
				</div>
				<div class="profile-blurb">
					<div class="profile-page-title">
					</div>
					<div class="profile-page-section">
						{{user.profile.about}}
					</div>
				</div>
			</div>
			<div class="featured row">
				<h1 class="heading">Featured</h1>
				{% for article in user.author.article_set.all %} <!-- Change this to featured only -->
				<div class="row">
		            <div class="center-block profile-articles">
		                <h1 class="article-post-title"><a href="{% url 'newshub:view_article' action_type='home' pk=article.pk %}">{{article.title}}</a></h1>
		                <p class="article-post-headline">{{article.headline}}</p>
		            </div>
		        </div>
				{% endfor %}
			</div>
		</div>
		<div id="profile-articles" class="row center-block tab-pane">
			<div class="row non-featured">
				{% for article in user.author.article_set.all %} <!-- Change this to non-featured only -->
				<div class="profile-articles">
	                <h1 class="article-post-title"><a href="{% url 'newshub:view_article' action_type='home' pk=article.pk %}">{{article.title}}</a></h1>
	                <p class="article-post-meta">
	                	<span class="date">{{article.time_uploaded|date:"N Y"}}</span>
	                	<span class="likes">{{article.likes.count}} Likes</span>
	                </p>
	            </div>
				{% endfor %}
			</div>
		</div>
		{% if request.user == user %}
		<div id="profile-update" class="row center-block tab-pane">
			<div class="row non-featured">
				<form class="form-horizontal" id="" method="post" action="{% url 'newshub:update_profile' request.user.profile.pk %}">
					{% csrf_token %}
					{% for field in profile_form %}
					<div class="form-group {%if field.errors %}has-feedback has-error{%endif%}">
						<label class="col-sm-offset-2 col-sm-2" for="{{field.id_for_label}}">{{field.label}}</label>
						{% if field.html_name == 'about' %}
						<div class="col-sm-6">
						{%else %}
						<div class="col-sm-4">
		        	   {%endif%}
							{% render_field field placeholder=field.label class='form-control' autocomplete='off'%}
			                {% for error in field.errors %}
			                     <span class="help-block">
			                        {{error}}
			                     </span>
		        	        {% endfor %}
		        	    </div>
			        </div>
					{% endfor %}
					<div class="form-group">
						<div class="post-tools col-sm-offset-4 col-sm-2">
							<input class="btn" type="submit" name="action" value="Update"/>
						</div>
					</div>
				</form>
			</div>
		</div>
		{% endif %}
	</div><!-- Profile Info -->
</div>
{%endblock%}